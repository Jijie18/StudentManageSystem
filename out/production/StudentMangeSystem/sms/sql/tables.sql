-- MySQL Script generated by MySQL Workbench
-- Wed May 15 14:30:33 2019
-- Model: New Model    Version: 1.0
-- MySQL Workbench Forward Engineering

SET @OLD_UNIQUE_CHECKS = @@UNIQUE_CHECKS, UNIQUE_CHECKS = 0;
SET @OLD_FOREIGN_KEY_CHECKS = @@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS = 0;
SET @OLD_SQL_MODE = @@SQL_MODE, SQL_MODE =
        'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION';

-- -----------------------------------------------------
-- Schema mydb
-- -----------------------------------------------------

-- -----------------------------------------------------
-- Schema mydb
-- -----------------------------------------------------
CREATE SCHEMA IF NOT EXISTS `mydb` DEFAULT CHARACTER SET utf8;
USE `mydb`;

-- -----------------------------------------------------
-- Table `mydb`.`Admin`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `mydb`.`Admin`;

CREATE TABLE IF NOT EXISTS `mydb`.`Admin`
(
    `admin_id`   INT         NOT NULL AUTO_INCREMENT,
    `admin_name` VARCHAR(45) NOT NULL,
    `password`   VARCHAR(45) NOT NULL default '123',
    PRIMARY KEY (`admin_id`),
    UNIQUE INDEX `admins` (`admin_id` ASC, `admin_name` ASC) VISIBLE
)
    ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `mydb`.`Building`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `mydb`.`Building`;

CREATE TABLE IF NOT EXISTS `mydb`.`Building`
(
    `building_id`   INT         NOT NULL AUTO_INCREMENT,
    `building_name` VARCHAR(45) NOT NULL,
    `area`          VARCHAR(45) NOT NULL,
    PRIMARY KEY (`building_id`),
    UNIQUE INDEX `building` (`building_name` ASC, `area` ASC) VISIBLE
)
    ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `mydb`.`Class`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `mydb`.`Class`;

CREATE TABLE IF NOT EXISTS `mydb`.`Class`
(
    `class_id`    INT NOT NULL AUTO_INCREMENT,
    `course_id`   INT NOT NULL,
    `schedule_id` INT NOT NULL,
    `capacity`    INT NOT NULL,
    PRIMARY KEY (`class_id`),
    INDEX `fk_Course_Subjects1_idx` (`course_id` ASC) VISIBLE,
    INDEX `fk_Class_schedule1_idx` (`schedule_id` ASC) VISIBLE,
    UNIQUE INDEX `class` (`class_id` ASC, `course_id` ASC) VISIBLE,
    CONSTRAINT `fk_Course_Subjects1`
        FOREIGN KEY (`course_id`)
            REFERENCES `mydb`.`Course` (`course_id`)
            ON DELETE CASCADE
            ON UPDATE CASCADE,
    CONSTRAINT `fk_Class_schedule1`
        FOREIGN KEY (`schedule_id`)
            REFERENCES `mydb`.`Schedule` (`schedule_id`)
            ON DELETE CASCADE
            ON UPDATE CASCADE
)
    ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `mydb`.`Class_Notice`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `mydb`.`Class_Notice`;

CREATE TABLE IF NOT EXISTS `mydb`.`Class_Notice`
(
    `class_id`  INT NOT NULL,
    `notice_id` INT NOT NULL,
    INDEX `fk_table1_Class1_idx` (`class_id` ASC) VISIBLE,
    PRIMARY KEY (`class_id`, `notice_id`),
    INDEX `notice_relation_idx` (`notice_id` ASC) VISIBLE,
    CONSTRAINT `fk_table1_Class1`
        FOREIGN KEY (`class_id`)
            REFERENCES `mydb`.`Class` (`class_id`)
            ON DELETE CASCADE
            ON UPDATE CASCADE,
    CONSTRAINT `notice_relation`
        FOREIGN KEY (`notice_id`)
            REFERENCES `mydb`.`Notice` (`notice_id`)
            ON DELETE CASCADE
            ON UPDATE CASCADE
)
    ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `mydb`.`Class_Selection`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `mydb`.`Class_Selection`;

CREATE TABLE IF NOT EXISTS `mydb`.`Class_Selection`
(
    `student_id`  INT NOT NULL,
    `class_id`    INT NOT NULL,
    `wage_number` INT NOT NULL,
    PRIMARY KEY (`student_id`, `class_id`),
    INDEX `class_selection_idx` (`class_id` ASC) VISIBLE,
    CONSTRAINT `student_selection`
        FOREIGN KEY (`student_id`)
            REFERENCES `mydb`.`Student` (`student_id`)
            ON DELETE CASCADE
            ON UPDATE CASCADE,
    CONSTRAINT `class_selection`
        FOREIGN KEY (`class_id`)
            REFERENCES `mydb`.`Class` (`class_id`)
            ON DELETE CASCADE
            ON UPDATE CASCADE
)
    ENGINE = InnoDB;
-- -----------------------------------------------------
-- Table `mydb`.`Class_Selection_Draft`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `mydb`.`Class_Selection_Draft`;

CREATE TABLE IF NOT EXISTS `mydb`.`Class_Selection_Draft`
(
    `Student_student_id` INT NOT NULL,
    `Class_class_id`     INT NOT NULL,
    `wage_number`        INT NOT NULL,
    PRIMARY KEY (`Student_student_id`, `Class_class_id`),
    INDEX `fk_Class_Selection_Draft_Student1_idx` (`Student_student_id` ASC) VISIBLE,
    INDEX `fk_Class_Selection_Draft_Class1_idx` (`Class_class_id` ASC) VISIBLE,
    CONSTRAINT `fk_Class_Selection_Draft_Student1`
        FOREIGN KEY (`Student_student_id`)
            REFERENCES `mydb`.`Student` (`student_id`)
            ON DELETE cascade
            ON UPDATE cascade,
    CONSTRAINT `fk_Class_Selection_Draft_Class1`
        FOREIGN KEY (`Class_class_id`)
            REFERENCES `mydb`.`Class` (`class_id`)
            ON DELETE cascade
            ON UPDATE cascade
)
    ENGINE = InnoDB;

-- -----------------------------------------------------
-- Table `mydb`.`Course`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `mydb`.`Course`;

CREATE TABLE IF NOT EXISTS `mydb`.`Course`
(
    `course_id`   INT         NOT NULL AUTO_INCREMENT,
    `major_id`    INT         NOT NULL,
    `course_name` VARCHAR(45) NOT NULL,
    `acronym`     VARCHAR(10) NOT NULL,
    `total_hour`  INT         NOT NULL,
    `credit`      INT         NOT NULL,
    PRIMARY KEY (`course_id`),
    UNIQUE INDEX `name_UNIQUE` (`course_name` ASC) VISIBLE,
    INDEX `fk_Course_Major1_idx` (`major_id` ASC) VISIBLE,
    CONSTRAINT `fk_Course_Major1`
        FOREIGN KEY (`major_id`)
            REFERENCES `mydb`.`Major` (`major_id`)
            ON DELETE CASCADE
            ON UPDATE CASCADE
)
    ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `mydb`.`Course_Major`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `mydb`.`Course_Major`;

CREATE TABLE IF NOT EXISTS `mydb`.`Course_Major`
(
    `major_id`       INT     NOT NULL,
    `course_id`      INT     NOT NULL,
    `type_require`   CHAR(2) NOT NULL,
    PRIMARY KEY (`major_id`, `course_id`),
    INDEX `course_relation_idx` (`course_id` ASC) VISIBLE,
    CONSTRAINT `major_relation`
        FOREIGN KEY (`major_id`)
            REFERENCES `mydb`.`Major` (`major_id`)
            ON DELETE CASCADE
            ON UPDATE CASCADE,
    CONSTRAINT `course_relation`
        FOREIGN KEY (`course_id`)
            REFERENCES `mydb`.`Course` (`course_id`)
            ON DELETE CASCADE
            ON UPDATE CASCADE
)
    ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `mydb`.`Department`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `mydb`.`Department`;

CREATE TABLE IF NOT EXISTS `mydb`.`Department`
(
    `department_id`   INT         NOT NULL,
    `department_name` VARCHAR(45) NOT NULL,
    PRIMARY KEY (`department_id`),
    UNIQUE INDEX `name_UNIQUE` (`department_name` ASC) VISIBLE
)
    ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `mydb`.`Instructor`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `mydb`.`Instructor`;

CREATE TABLE IF NOT EXISTS `mydb`.`Instructor`
(
    `instructor_id`   INT         NOT NULL AUTO_INCREMENT,
    `major_id`        INT         NOT NULL,
    `password`        VARCHAR(45) NOT NULL default '123',
    `instructor_name` VARCHAR(45) NOT NULL,
    `age`             INT         NOT NULL,
    `sex`             CHAR(1)     NOT NULL,
    `joined_date`     DATE        NOT NULL,
    PRIMARY KEY (`instructor_id`),
    INDEX `fk_Professor_Major1_idx` (`major_id` ASC) VISIBLE,
    UNIQUE INDEX `instructor` (`instructor_name` ASC, `age` ASC, `sex` ASC, `joined_date` ASC, `major_id`
                               ASC) INVISIBLE,
    CONSTRAINT `fk_Professor_Major1`
        FOREIGN KEY (`major_id`)
            REFERENCES `mydb`.`Major` (`major_id`)
            ON DELETE CASCADE
            ON UPDATE CASCADE
)
    ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `mydb`.`Lesson`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `mydb`.`Lesson`;

CREATE TABLE IF NOT EXISTS `mydb`.`Lesson`
(
    `lesson_id`     INT NOT NULL AUTO_INCREMENT,
    `class_id`      INT NOT NULL,
    `room_id`       INT NOT NULL,
    `instructor_id` INT NOT NULL,
    `time_id`       INT NOT NULL,
    INDEX `fk_Class_Course1_idx` (`class_id` ASC) VISIBLE,
    INDEX `fk_Class_Room1_idx` (`room_id` ASC) VISIBLE,
    INDEX `fk_EachClass_Professor1_idx` (`instructor_id` ASC) VISIBLE,
    PRIMARY KEY (`lesson_id`),
    UNIQUE INDEX `Lesson` (`class_id` ASC, `room_id` ASC, `time_id` ASC) INVISIBLE,
    INDEX `fk_Lesson_time1_idx` (`time_id` ASC) VISIBLE,
    CONSTRAINT `fk_Class_Course1`
        FOREIGN KEY (`class_id`)
            REFERENCES `mydb`.`Class` (`class_id`)
            ON DELETE CASCADE
            ON UPDATE CASCADE,
    CONSTRAINT `fk_Class_Room1`
        FOREIGN KEY (`room_id`)
            REFERENCES `mydb`.`Room` (`room_id`)
            ON DELETE NO ACTION
            ON UPDATE NO ACTION,
    CONSTRAINT `fk_EachClass_Professor1`
        FOREIGN KEY (`instructor_id`)
            REFERENCES `mydb`.`Instructor` (`instructor_id`)
            ON DELETE NO ACTION
            ON UPDATE NO ACTION,
    CONSTRAINT `fk_Lesson_time1`
        FOREIGN KEY (`time_id`)
            REFERENCES `mydb`.`Time` (`time_id`)
            ON DELETE NO ACTION
            ON UPDATE NO ACTION
)
    ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `mydb`.`Major`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `mydb`.`Major`;

CREATE TABLE IF NOT EXISTS `mydb`.`Major`
(
    `major_id`         INT         NOT NULL AUTO_INCREMENT,
    `major_name`       VARCHAR(45) NOT NULL,
    `department_id`    INT         NOT NULL,
    `optional_credits` INT         NOT NULL,
    PRIMARY KEY (`major_id`),
    UNIQUE INDEX `majorname_UNIQUE` (`major_name` ASC) VISIBLE,
    INDEX `fk_department_id_idx` (`department_id` ASC) VISIBLE,
    CONSTRAINT `fk_department_id`
        FOREIGN KEY (`department_id`)
            REFERENCES `mydb`.`Department` (`department_id`)
            ON DELETE CASCADE
            ON UPDATE CASCADE
)
    ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `mydb`.`Notice`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `mydb`.`Notice`;

CREATE TABLE IF NOT EXISTS `mydb`.`Notice`
(
    `notice_id`    INT          NOT NULL AUTO_INCREMENT,
    `text`         VARCHAR(200) NOT NULL,
    `publish_time` TIMESTAMP    NOT NULL,
    PRIMARY KEY (`notice_id`),
    UNIQUE INDEX `notice_text` (`text` ASC, `publish_time` ASC) VISIBLE,
    UNIQUE INDEX `notice` (`publish_time` ASC, `notice_id` ASC) VISIBLE
)
    ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `mydb`.`Prerequire`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `mydb`.`Prerequire`;

CREATE TABLE IF NOT EXISTS `mydb`.`Prerequire`
(
    `course_id`     INT NOT NULL,
    `pre_course_id` INT NOT NULL,
    `pre_group`     INT NOT NULL,
    INDEX `fk_prerequire_Course1_idx` (`course_id` ASC) VISIBLE,
    INDEX `fk_prerequire_Course2_idx` (`pre_course_id` ASC) VISIBLE,
    PRIMARY KEY (`course_id`, `pre_course_id`, `pre_group`),
    CONSTRAINT `fk_prerequire_Course1`
        FOREIGN KEY (`course_id`)
            REFERENCES `mydb`.`Course` (`course_id`)
            ON DELETE CASCADE
            ON UPDATE CASCADE,
    CONSTRAINT `fk_prerequire_Course2`
        FOREIGN KEY (`pre_course_id`)
            REFERENCES `mydb`.`Course` (`course_id`)
            ON DELETE CASCADE
            ON UPDATE CASCADE
)
    ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `mydb`.`Room`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `mydb`.`Room`;

CREATE TABLE IF NOT EXISTS `mydb`.`Room`
(
    `room_id`     INT         NOT NULL AUTO_INCREMENT,
    `building_id` INT         NOT NULL,
    `room_number` VARCHAR(10) NOT NULL,
    `floor`       INT         NULL,
    PRIMARY KEY (`room_id`),
    INDEX `fk_classroom_Building1_idx` (`building_id` ASC) VISIBLE,
    UNIQUE INDEX `ROOM` (`room_number` ASC, `floor` ASC, `building_id` ASC) INVISIBLE,
    CONSTRAINT `fk_classroom_Building1`
        FOREIGN KEY (`building_id`)
            REFERENCES `mydb`.`Building` (`building_id`)
            ON DELETE CASCADE
            ON UPDATE CASCADE
)
    ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `mydb`.`Schedule`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `mydb`.`Schedule`;

CREATE TABLE IF NOT EXISTS `mydb`.`Schedule`
(
    `schedule_id` INT     NOT NULL AUTO_INCREMENT,
    `year`        INT     NOT NULL,
    `semester`    CHAR(1) NULL,
    PRIMARY KEY (`schedule_id`),
    UNIQUE INDEX `schedule` (`year` ASC, `semester` ASC) VISIBLE
)
    ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `mydb`.`Student`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `mydb`.`Student`;

CREATE TABLE IF NOT EXISTS `mydb`.`Student`
(
    `student_id`           INT         NOT NULL AUTO_INCREMENT,
    `student_name`         VARCHAR(45) NOT NULL,
    `password`             VARCHAR(45) NOT NULL default '123',
    `age`                  INT         NOT NULL,
    `sex`                  CHAR(1)     NOT NULL,
    `admission_year`       INT         NOT NULL,
    `administrative_class` INT         NOT NULL,
    `grade`                INT         NOT NULL,
    `instructor_id`        INT         NOT NULL,
    `major_id`             INT         NOT NULL,
    `left_wage`            INT      default 100,
    PRIMARY KEY (`student_id`),
    INDEX `fk_Students_Teacher1_idx` (`instructor_id` ASC) VISIBLE,
    UNIQUE INDEX `students` (`student_name` ASC, `age` ASC, `sex` ASC, `admission_year` ASC, `administrative_class`
                             ASC) VISIBLE,
    INDEX `fk_Students_Major1_idx` (`major_id` ASC) VISIBLE,
    CONSTRAINT `fk_Students_Teacher1`
        FOREIGN KEY (`instructor_id`)
            REFERENCES `mydb`.`Instructor` (`instructor_id`)
            ON DELETE NO ACTION
            ON UPDATE NO ACTION,
    CONSTRAINT `fk_Students_Major1`
        FOREIGN KEY (`major_id`)
            REFERENCES `mydb`.`Major` (`major_id`)
            ON DELETE NO ACTION
            ON UPDATE NO ACTION
)
    ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `mydb`.`Student_Class`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `mydb`.`Student_Class`;

CREATE TABLE IF NOT EXISTS `mydb`.`Student_Class`
(
    `student_id` INT NOT NULL,
    `class_id`   INT NOT NULL,
    PRIMARY KEY (`student_id`, `class_id`),
    INDEX `fk_Students_has_Class_Class1_idx` (`class_id` ASC) VISIBLE,
    INDEX `fk_Students_has_Class_Students1_idx` (`student_id` ASC) VISIBLE,
    CONSTRAINT `fk_Students_has_Class_Students1`
        FOREIGN KEY (`student_id`)
            REFERENCES `mydb`.`Student` (`student_id`)
            ON DELETE CASCADE
            ON UPDATE CASCADE,
    CONSTRAINT `fk_Students_has_Class_Class1`
        FOREIGN KEY (`class_id`)
            REFERENCES `mydb`.`Class` (`class_id`)
            ON DELETE CASCADE
            ON UPDATE CASCADE
)
    ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `mydb`.`Student_Class_Score`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `mydb`.`Student_Class_Score`;

CREATE TABLE IF NOT EXISTS `mydb`.`Student_Class_Score`
(
    `student_id` INT NOT NULL,
    `class_id`   INT NOT NULL,
    `score`      INT NULL default 100,
    PRIMARY KEY (`student_id`, `class_id`),
    INDEX `fk_Students_has_Class_Score_Class1_idx` (`class_id` ASC) VISIBLE,
    INDEX `fk_Students_has_Class_Score_Students1_idx` (`student_id` ASC) VISIBLE,
    CONSTRAINT `fk_Students_has_Class_Score_Students1`
        FOREIGN KEY (`student_id`)
            REFERENCES `mydb`.`Student` (`student_id`)
            ON DELETE CASCADE
            ON UPDATE CASCADE,
    CONSTRAINT `fk_Students_has_Class_Score_Class1`
        FOREIGN KEY (`class_id`)
            REFERENCES `mydb`.`Class` (`class_id`)
            ON DELETE CASCADE
            ON UPDATE CASCADE
)
    ENGINE = InnoDB;

-- -----------------------------------------------------
-- Table `mydb`.`Time`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `mydb`.`Time`;

CREATE TABLE IF NOT EXISTS `mydb`.`Time`
(
    `time_id` INT         NOT NULL AUTO_INCREMENT,
    `weekday` VARCHAR(10) NOT NULL,
    `start`   INT         NOT NULL,
    `end`     INT         NOT NULL,
    `week`    CHAR(1)     NOT NULL,
    PRIMARY KEY (`time_id`),
    UNIQUE INDEX `time` (`weekday` ASC, `start` ASC, `end` ASC, `week` ASC) VISIBLE
)
    ENGINE = InnoDB;


SET SQL_MODE = @OLD_SQL_MODE;
SET FOREIGN_KEY_CHECKS = @OLD_FOREIGN_KEY_CHECKS;
SET UNIQUE_CHECKS = @OLD_UNIQUE_CHECKS;
